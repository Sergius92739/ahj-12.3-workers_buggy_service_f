"use strict";(self.webpackChunkahj_12_3_workers_buggy_service_f=self.webpackChunkahj_12_3_workers_buggy_service_f||[]).push([[143],{257:()=>{class e{constructor(e,s){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e,this.newsList=null,this.updateBtn=null,this.url=s}init(){e.registerSW(),this.registerOnMessageSW(),this.bindToDOM(),this.createRequest()}registerOnMessageSW(){navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",(e=>{"error"===e.data&&this.showError()}))}static registerSW(){(async()=>{navigator.serviceWorker&&window.addEventListener("load",(async()=>{try{await navigator.serviceWorker.register("./service.worker.js"),console.log("service worker is registered")}catch(e){console.log(e)}}))})()}bindToDOM(){this.container.innerHTML=e.startMarkUp,this.newsList=this.container.querySelector(".news__list"),this.updateBtn=this.container.querySelector(".header__btn"),this.updateBtn.addEventListener("click",(()=>this.createRequest()))}async createRequest(){try{this.showAnimation();const e=await fetch(this.url),s=await e.json();this.hideAnimation(),this.showNews(s.data)}catch(e){console.log("Error: ",e),this.showAnimation(),this.showError()}}static get startMarkUp(){return'<div class="container">\n    <header class="header">\n      <h1 class="header__title">Новости мира кино</h1>\n      <button class="header__btn">Обновить</button>\n    </header>\n    <div class="news__list"></div>\n  </div>'}static newsMarkUp(e="",s="",t="",i=""){return`<div class="news" data-id="${i}">\n    <div class="news__date">${e}</div>\n    <div class="news__content">\n      <div class="news__imagebox">\n        <img src="${t}" alt="">\n      </div>\n      <div class="news__text">\n        <div class="mask-text__item">${s}</div>\n      </div>\n    </div>\n  </div>`}showNews(s){s.forEach((s=>{this.newsList.insertAdjacentHTML("beforeend",e.newsMarkUp(s.created,s.title,s.image,s.id))}))}showAnimation(){for(this.newsList.innerHTML="";this.newsList.children.length<3;)this.newsList.insertAdjacentHTML("beforeend",e.newsMarkUp());this.newsList.classList.add("anime")}hideAnimation(){this.newsList.classList.contains("anime")&&(this.newsList.querySelectorAll(".news").forEach((e=>e.remove())),this.newsList.classList.remove("anime"))}showError(){this.newsList.insertAdjacentHTML("beforeend",'<div class="error">\n    <div class="error__mes">\n      Не удалось загрузить данные. Проверьте подключение и обновите страницу.\n    </div>\n  </div>')}hideError(){this.newsList.querySelector(".error")&&this.newsList.querySelector(".error").remove()}}new e(document.getElementById("root"),"https://ahj-12-3.sergem.xyz/news").init()}},e=>{e(e.s=257)}]);